<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Peakora Onboarding</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="assistant.css">
</head>
<body>
  <div class="assistant-shell">
    <div class="assistant-card">
      <header class="assistant-header">
        <div class="brand">
          <div class="brand-mark"></div>
          <div>
            <div class="brand-name">PEAKORA</div>
            <div class="brand-tagline">Gentle guidance. Real momentum.</div>
          </div>
        </div>
      </header>

      <div class="assistant-progress">
        <div class="progress-label">Step 1 of 13</div>
        <div class="progress-bar"><div class="progress-fill"></div></div>
      </div>

      <main id="step-container" class="assistant-body"></main>

      <footer class="assistant-footer">
        © 2026 Peakora™ — For a Better You.
      </footer>
    </div>
  </div>

  <script>
    const steps = [
      "welcome","explanation","goal","challenge","time","insight",
      "extended1","extended2","email","processing","recommendations",
      "pricing","done"
    ];

    const STORAGE_KEY = "peakora_assistant_state_v1";
    const state = { stepIndex: 0, answers: {}, email: "", completed: false };

    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return false;
      try{ Object.assign(state, JSON.parse(raw)); return true; }catch{ return false; }
    }
    function clearState(){ localStorage.removeItem(STORAGE_KEY); state.stepIndex=0; state.answers={}; state.email=""; state.completed=false; }

    function goToStepKey(key){
      const index = steps.indexOf(key);
      if(index>=0){ state.stepIndex=index; saveState(); renderStep(); }
    }
    function goToPrevious(){ if(state.stepIndex>0){ state.stepIndex--; saveState(); renderStep(); } }

    function setProgress(){
      const key = steps[state.stepIndex];
      const bar=document.querySelector(".progress-fill");
      const label=document.querySelector(".progress-label");
      if(!bar||!label) return;
      const pct=((state.stepIndex+1)/steps.length)*100;
      bar.style.width=pct+"%";
      label.textContent="Step "+(state.stepIndex+1)+" of "+steps.length;
    }

    function renderStep(){
      const container=document.getElementById("step-container");
      const key=steps[state.stepIndex];
      setProgress();

      if(key==="welcome"){
        container.innerHTML='<div class="step"><h1>Hi, I’m Peakora.</h1><p>Let’s take a gentle step toward the version of you that feels more grounded and steady.</p><div class="actions"><button class="btn primary" onclick="goToStepKey(\'explanation\')">Begin</button></div></div>';
        return;
      }
      if(key==="explanation"){
        container.innerHTML='<div class="step"><h2>How this works</h2><p>I’ll ask a few simple questions about your energy, your time, and what’s been weighing on you.</p><p>Then I’ll shape a 7-day plan that feels doable, not overwhelming.</p><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="goToStepKey(\'goal\')">Continue</button></div></div>';
        return;
      }
      if(key==="goal"){
        container.innerHTML='<div class="step"><h2>What’s one area you’d like to feel better in?</h2><textarea class="input" id="goal-input"></textarea><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="handleGoal()">Continue</button></div></div>';
        return;
      }
      if(key==="challenge"){
        container.innerHTML='<div class="step"><h2>What’s been making this hard lately?</h2><textarea class="input" id="challenge-input"></textarea><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="handleChallenge()">Continue</button></div></div>';
        return;
      }
      if(key==="time"){
        container.innerHTML='<div class="step"><h2>How much time feels doable?</h2><div class="options"><button class="btn ghost" onclick="handleTime(\'5–10 minutes\')">5–10 minutes</button><button class="btn ghost" onclick="handleTime(\'15–20 minutes\')">15–20 minutes</button><button class="btn ghost" onclick="handleTime(\'30+ minutes\')">30+ minutes</button></div></div>';
        return;
      }
      if(key==="insight"){
        container.innerHTML='<div class="step"><h2>Anything else I should know?</h2><textarea class="input" id="insight-input"></textarea><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="handleInsight()">Continue</button></div></div>';
        return;
      }
      if(key==="extended1"){
        container.innerHTML='<div class="step"><h2>What would feel like a gentle win?</h2><textarea class="input" id="extended1-input"></textarea><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="handleExtended1()">Continue</button></div></div>';
        return;
      }
      if(key==="extended2"){
        container.innerHTML='<div class="step"><h2>What tends to throw you off?</h2><textarea class="input" id="extended2-input"></textarea><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="handleExtended2()">Continue</button></div></div>';
        return;
      }
      if(key==="email"){
        container.innerHTML='<div class="step"><h2>Where should I send your plan?</h2><input type="email" class="input" id="email-input" value="'+(state.email||"")+'"><div class="actions"><button class="btn secondary" onclick="goToPrevious()">Back</button><button class="btn primary" onclick="handleEmail()">Send my plan</button></div></div>';
        return;
      }
      if(key==="processing"){
        container.innerHTML='<div class="step step-centered"><h2>One moment</h2><p>I’m shaping your plan…</p><div class="loader"></div></div>';
        setTimeout(()=>goToStepKey("recommendations"),2000);
        return;
      }
      if(key==="recommendations"){
        container.innerHTML='<div class="step"><h2>Your plan is ready</h2><p>Preview: daily focus, anchor habit, forgiveness for off days.</p><div class="actions"><button class="btn primary" onclick="goToStepKey(\'pricing\')">Continue</button></div></div>';
        return;
      }
      if(key==="pricing"){
        container.innerHTML='<div class="step"><h2>What’s coming next</h2><p>Peakora is free now. Soon you’ll be able to save multiple plans, track check-ins, and more.</p><div class="actions"><button class="btn primary" onclick="goToStepKey(\'done\')">Finish</button></div></div>';
        return;
      }
      if(key==="done"){
        state.completed=true; saveState();
        container.innerHTML='<div class="step step-centered"><h2>Your plan is on its way</h2><p>You showed up for yourself today.</p><a href="assistant-home.html" class="btn primary">Go to home</a></div>';
        return;
      }
    }

    function handleGoal(){ const v=document.getElementById("goal-input").value.trim(); if(!v){alert("Please share your goal.");return;} state.answers.goal=v; saveState(); goToStepKey("challenge"); }
    function handleChallenge(){ const v=document.getElementById("challenge-input").value.trim(); if(!v){alert("Please share your challenge.");return;} state.answers.challenge=v; saveState(); goToStepKey("time"); }
    function handleTime(choice){ state.answers.time=choice; saveState(); goToStepKey("insight"); }
    function handleInsight(){ state.answers.insight=document.getElementById("insight-input").value.trim(); saveState(); goToStepKey("extended1"); }
        function handleExtended1(){
      state.answers.extended1=document.getElementById("extended1-input").value.trim();
      saveState();
      goToStepKey("extended2");
    }

    function handleExtended2(){
      state.answers.extended2=document.getElementById("extended2-input").value.trim();
      saveState();
      goToStepKey("email");
    }

    function handleEmail(){
      const v=document.getElementById("email-input").value.trim();
      if(!v || v.indexOf("@")===-1){
        alert("Please enter a valid email address.");
        return;
      }
      state.email=v;
      saveState();
      goToStepKey("processing");
    }

    function restartOnboarding(){
      clearState();
      state.stepIndex=steps.indexOf("welcome");
      saveState();
      renderStep();
    }

    document.addEventListener("DOMContentLoaded",function(){
      const hasState=loadState();
      if(!hasState){ goToStepKey("welcome"); return; }
      if(state.completed){ window.location.href="assistant-home.html"; return; }
      renderStep();
    });
  </script>

  <script>
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("./service-worker.js");
    }
  </script>
</body>
</html>
